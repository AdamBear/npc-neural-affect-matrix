# 🌐 Web UI - NPC Neural Affect Matrix

一个简单但功能完整的前端界面，用于测试和演示 NPC Neural Affect Matrix Web API。

## 🎯 功能特性

### ✨ 核心功能
- ✅ **服务器健康检查** - 实时监控 API 状态
- ✅ **模型初始化** - 一键初始化神经情绪模型
- ✅ **NPC 管理** - 创建、选择、删除 NPC
- ✅ **交互测试** - 评估文本的情绪影响
- ✅ **情绪可视化** - 实时显示 Valence 和 Arousal
- ✅ **记忆管理** - 查看和清除 NPC 记忆
- ✅ **操作日志** - 记录所有操作和结果

### 🎨 界面特点
- 📊 **情绪环状图** - 基于 Russell 情绪模型的可视化
- 📈 **情绪仪表盘** - 直观的情绪数值显示
- 🎛️ **滑块控制** - 轻松调整 NPC 性格参数
- 📝 **实时日志** - 所有操作实时反馈
- 📱 **响应式设计** - 支持桌面和移动设备

## 🚀 快速开始

### 1. 启动 Web API 服务器

首先确保 Web API 服务器正在运行：

```bash
# 在项目根目录
cd ..
cargo run --release

# 或使用启动脚本
./run-web-server.sh prod
```

服务器将在 `http://localhost:3000` 启动。

### 2. 打开 Web UI

有几种方式可以打开前端页面：

#### 方法 1: 直接在浏览器打开（推荐）

```bash
# Windows
start web-ui/index.html

# Linux/Mac
open web-ui/index.html
# 或
xdg-open web-ui/index.html
```

#### 方法 2: 使用本地 HTTP 服务器

如果遇到 CORS 问题，可以使用本地 HTTP 服务器：

```bash
# 使用 Python
cd web-ui
python -m http.server 8080

# 或使用 Node.js (需要安装 http-server)
npx http-server web-ui -p 8080
```

然后在浏览器访问: `http://localhost:8080`

### 3. 开始测试

1. **检查服务器状态** - 页面加载后会自动检查
2. **初始化模型** - 点击 "初始化模型" 按钮
3. **创建 NPC** - 填写 NPC 信息并创建
4. **测试交互** - 输入文本并评估情绪
5. **查看结果** - 观察情绪变化和可视化

## 📖 使用指南

### 服务器状态面板

- **未连接** (红色) - 无法连接到 API 服务器
- **已连接** (绿色) - 服务器正常运行
- **初始化中** (黄色) - 模型正在加载
- **模型已就绪** (绿色) - 可以开始创建 NPC

### NPC 管理

#### 创建 NPC

1. **NPC 名称**: 为 NPC 起一个名字（例如: 村庄守卫）
2. **背景故事**: 描述 NPC 的背景和性格
3. **Valence (愉悦度)**: 调整 NPC 的基础情绪倾向
   - `-1.0`: 消极、悲观
   - `0.0`: 中性
   - `+1.0`: 积极、乐观
4. **Arousal (唤醒度)**: 调整 NPC 的能量水平
   - `-1.0`: 冷静、疲惫
   - `0.0`: 平静
   - `+1.0`: 兴奋、激动
5. **记忆衰减率**: 控制记忆淡忘速度 (0.0-1.0)
   - `0.0`: 永不遗忘
   - `0.1`: 缓慢遗忘（推荐）
   - `1.0`: 快速遗忘

#### 管理 NPC

- **选择 NPC**: 点击 NPC 列表中的 "选择" 按钮
- **删除 NPC**: 选择 NPC 后点击 "删除当前 NPC"
- **多个 NPC**: 可以创建多个 NPC 并在它们之间切换

### 交互测试

#### 评估交互

1. 确保已选择一个 NPC
2. 在 "交互文本" 框输入对话或动作描述
3. (可选) 填写 "来源 ID" 标识谁说的话
4. 点击 "评估交互" 查看情绪响应

#### 示例交互

**正面交互**:
- "谢谢你救了我的命！"
- "你的建议真有帮助。"
- "我们是朋友。"

**负面交互**:
- "滚开！"
- "你骗了我！"
- "我恨你！"

**中性交互**:
- "今天天气不错。"
- "你知道去市场的路吗？"

### 情绪可视化

#### 情绪仪表盘

显示当前的 Valence 和 Arousal 数值，以及对应的仪表条：

- **绿色仪表**: 正面情绪 (Valence > 0)
- **红色仪表**: 负面情绪 (Valence < 0)
- **橙色仪表**: 高唤醒 (Arousal > 0)
- **蓝色仪表**: 低唤醒 (Arousal < 0)

#### 情绪环状图

基于 Russell 的情绪环状模型，显示 NPC 在二维情绪空间中的位置：

- **右上角**: 兴奋、快乐
- **右下角**: 平静、满足
- **左上角**: 愤怒、害怕
- **左下角**: 悲伤、沮丧

### 记忆管理

- **获取记忆**: 查看 NPC 的所有记忆记录
- **清除记忆**: 删除所有记忆，将 NPC 重置为基础性格

记忆数据包含：
- `id`: 记忆 ID
- `source_id`: 来源标识
- `text`: 交互文本
- `valence`: 该记忆的愉悦度
- `arousal`: 该记忆的唤醒度
- `past_time`: 记忆发生的时间

## 🎮 使用示例

### 示例 1: 友好商人

```
名称: 马库斯 (商人)
背景: 经营杂货店20年，以公平价格和好建议闻名。
Valence: 0.3 (略微积极)
Arousal: -0.1 (略微平静)
记忆衰减: 0.1

测试交互:
1. "谢谢你多年来的帮助！" (player)
   → 预期: Valence 增加，Arousal 略增

2. "你的价格总是很公道！" (player)
   → 预期: Valence 进一步增加

3. "把你的金子都交出来！" (thief)
   → 预期: Valence 降低，Arousal 增加（恐惧）

4. 查看对 player 和 thief 的不同情绪
```

### 示例 2: 严肃守卫

```
名称: 艾伦 (城门守卫)
背景: 保卫城市15年，严格执行规则。
Valence: -0.1 (略微消极)
Arousal: 0.2 (略微警觉)
记忆衰减: 0.05 (记忆力强)

测试交互:
1. "早上好，守卫先生。" (citizen)
   → 预期: 轻微正面反应

2. "你在这里干什么？" (suspicious_person)
   → 预期: 提高警觉

3. "感谢你保护我们的安全！" (mayor)
   → 预期: Valence 显著增加
```

## 🛠️ 技术细节

### 技术栈

- **纯 HTML/CSS/JavaScript** - 无需构建工具
- **Fetch API** - 用于 HTTP 请求
- **CSS Grid & Flexbox** - 响应式布局
- **ES6+ JavaScript** - 现代 JavaScript 特性

### API 端点使用

界面使用了以下 API 端点：

| 功能 | 端点 | 方法 |
|------|------|------|
| 健康检查 | `/health` | GET |
| 初始化模型 | `/api/v1/initialize` | POST |
| 创建 NPC | `/api/v1/npcs` | POST |
| 删除 NPC | `/api/v1/npcs/:id` | DELETE |
| 评估交互 | `/api/v1/npcs/:id/evaluate` | POST |
| 获取情绪 | `/api/v1/npcs/:id/emotion` | GET |
| 特定来源情绪 | `/api/v1/npcs/:id/emotion/:source` | GET |
| 获取记忆 | `/api/v1/npcs/:id/memory` | GET |
| 清除记忆 | `/api/v1/npcs/:id/memory` | DELETE |

### 浏览器兼容性

支持所有现代浏览器：

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## 🐛 故障排除

### 问题: 无法连接到服务器

**解决方案**:
1. 确保 Web API 服务器正在运行
2. 检查服务器是否在 `http://localhost:3000`
3. 查看浏览器控制台的错误信息

### 问题: CORS 错误

**解决方案**:
Web API 已启用 CORS，应该不会有问题。如果还是遇到：
1. 确保从 `file://` 协议打开页面
2. 或使用本地 HTTP 服务器（见上文）

### 问题: 模型初始化失败

**解决方案**:
1. 首次运行需要下载模型文件（约100MB+）
2. 等待下载完成（可能需要几分钟）
3. 检查服务器日志中的错误信息

### 问题: 页面样式显示异常

**解决方案**:
确保使用现代浏览器并启用 JavaScript。

## 📝 自定义

### 修改 API 地址

如果服务器不在 `localhost:3000`，修改 `index.html` 中的：

```javascript
const API_BASE = 'http://your-server:port/api/v1';
```

### 调整样式

所有样式都在 `<style>` 标签中，可以根据需要修改：

- 颜色主题
- 字体大小
- 布局间距
- 动画效果

## 🎯 下一步

- [ ] 添加情绪历史图表
- [ ] 支持批量交互测试
- [ ] 导出/导入 NPC 配置
- [ ] 多语言支持
- [ ] 情绪预设模板

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](../LICENSE) 文件。
